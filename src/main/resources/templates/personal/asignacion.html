<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="/layouts/_mainLayout">

<head>
    <title>Asignación de Equipo | Apex Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/styleIndex.css}" />
</head>

<body>
    <div layout:fragment="content">
        <!-- Mostrar mensajes de éxito/error -->
        <div th:if="${success != null}">
            <script>
                Swal.fire({
                    title: "Confirmación",
                    text: '[[${success}]]',
                    icon: "success"
                });
            </script>
        </div>

         <div th:if="${error != null}">
            <script>
                Swal.fire({
                    title: "¡Error!",
                    text: '[[${error}]]',
                    icon: "error",
                    confirmButtonColor: "#d33"
                });
            </script>
        </div>

        <div class="app-card mb-4 bg-primary bg-opacity-10 p-3 rounded">
            <h2 class="h4 card-title mb-0 text-primary"><i class="fas fa-laptop-medical"></i> Asignar Equipos a Personal</h2>
        </div>

        <!-- Información del Personal -->
        <div class="app-card mb-4">
            <div class="row">
                <div class="col-md-6">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0"><i class="fas fa-user"></i> Información del Personal</h4>
                        </div>
                        <div class="card-body bg-primary bg-opacity-10">
                            <p><strong class="text-primary">Nombre:</strong> <span th:text="${personal.nombre + ' ' + personal.apellido}" class="text-dark"></span></p>
                            <p><strong class="text-primary">Email:</strong> <span th:text="${personal.email}" class="text-dark"></span></p>
                            <p><strong class="text-primary">Usuario:</strong> <span th:text="${personal.username}" class="text-dark"></span></p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card border-warning">
                        <div class="card-header bg-warning text-dark">
                            <h4 class="mb-0"><i class="fas fa-laptop"></i> Equipos Asignados</h4>
                        </div>
                        <div class="card-body bg-warning bg-opacity-10">
                            <div class="table-responsive">
                                <table class="table table-hover" th:if="${not #lists.isEmpty(equiposAsignados)}">
                                    <thead class="table-warning">
                                        <tr>
                                            <th class="text-dark">Nombre</th>
                                            <th class="text-dark">N° Serie</th>
                                            <th class="text-dark">Ubicación</th>
                                            <th class="text-dark">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="equipo : ${equiposAsignados}">
                                            <td th:text="${equipo.nombre}" class="text-dark"></td>
                                            <td th:text="${equipo.nserie}" class="text-dark"></td>
                                            <td th:text="${equipo.ubicacion?.nombreUbicacion} ?: 'Sin ubicación'" class="text-dark"></td>
                                            <td>
                                                <a th:href="@{/asignaciones/desasignar/{personalId}/{equipoId}(personalId=${personal.id}, equipoId=${equipo.id})}" 
                                                   class="btn btn-sm btn-danger">
                                                   <i class="fas fa-trash-alt"></i> Desasignar
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div th:if="${#lists.isEmpty(equiposAsignados)}" class="alert alert-warning">
                                <i class="fas fa-info-circle"></i> No tiene equipos asignados
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buscador de Equipos -->
        <div class="app-card mb-4">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="fas fa-search"></i> Buscar Equipos Disponibles</h4>
                </div>
                <div class="card-body bg-success bg-opacity-10">
                    <form th:action="@{/asignaciones/asignar/{personalId}(personalId=${personal.id})}" method="get">
                        <div class="row g-3 align-items-center">
                            <div class="col-md-3">
                                <input type="text" class="form-control border-success" name="nombre" placeholder="Nombre" th:value="${param.nombre}">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control border-success" name="nserie" placeholder="N° Serie" th:value="${param.nserie}">
                            </div>
                            <div class="col-md-3">
                                <select class="form-select border-success" name="ubicacion">
                                    <option value="">Todas las ubicaciones</option>
                                    <option th:each="ubicacion : ${ubicaciones}" 
                                            th:value="${ubicacion.id}"
                                            th:text="${ubicacion.nombreUbicacion}"
                                            th:selected="${param.ubicacion != null and param.ubicacion == ubicacion.id.toString()}">
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <div class="d-grid gap-2 d-md-flex">
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-search"></i> Buscar
                                    </button>
                                    <a th:href="@{/asignaciones/asignar/{personalId}(personalId=${personal.id})}" 
                                       class="btn btn-outline-success">
                                       <i class="fas fa-sync-alt"></i> Limpiar
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Resultados de Equipos Disponibles -->
        <div class="app-card">
            <div class="card border-info">
                <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="fas fa-laptop"></i> Equipos Disponibles</h4>
                    <span class="badge bg-dark" th:text="${equiposDisponibles.totalElements} + ' disponibles'"></span>
                </div>
                <div class="card-body bg-info bg-opacity-10">
                    <div th:if="${not equiposDisponibles.empty}">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-info">
                                    <tr>
                                        <th class="text-dark">Nombre</th>
                                        <th class="text-dark">N° Serie</th>
                                        <th class="text-dark">Modelo</th>
                                        <th class="text-dark">Ubicación</th>
                                        <th class="text-dark">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="equipo : ${equiposDisponibles.content}">
                                        <td th:text="${equipo.nombre}" class="text-dark"></td>
                                        <td th:text="${equipo.nserie}" class="text-dark"></td>
                                        <td th:text="${equipo.modelo}" class="text-dark"></td>
                                        <td th:text="${equipo.ubicacion?.nombreUbicacion} ?: 'Sin ubicación'" class="text-dark"></td>
                                        <td>
                                            <form th:action="@{/asignaciones/asignar-equipo}" method="post">
                                                <input type="hidden" name="personalId" th:value="${personal.id}">
                                                <input type="hidden" name="equipoId" th:value="${equipo.id}">
                                                <button type="submit" class="btn btn-sm btn-success">
                                                    <i class="fas fa-plus"></i> Asignar
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                    <div th:if="${equiposDisponibles.empty}" class="alert alert-info">
                        <i class="fas fa-exclamation-triangle"></i> No se encontraron equipos disponibles con los filtros aplicados.
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>